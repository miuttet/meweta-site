<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>gigs — meweta</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="wrapper">

    <header class="anim-slide">
      <h1 class="site-title"><a href="index.html">meweta</a></h1>
      <nav>
        <a href="index.html">home</a>
        <a href="about.html">about</a>
        <a href="gigs.html" class="active">gigs</a>
        <a href="mixes.html">mixes</a>
        <a href="caress.html">caress</a>
      </nav>
    </header>

    <main>
      <div class="section-label anim-slide">upcoming</div>
      <ul class="gig-list" id="upcoming-list"></ul>

      <hr class="anim-slide">

      <div class="section-label anim-slide">past</div>
      <ul class="gig-list" id="past-list"></ul>
    </main>

    <footer>
      &copy; meweta
    </footer>

  </div>
  <script src="js/effects.js"></script>
  <script src="js/gigs-data.js"></script>
  <script>
    (function() {
      var today = new Date();
      today.setHours(0, 0, 0, 0);

      var upcomingList = document.getElementById('upcoming-list');
      var pastList = document.getElementById('past-list');
      var upcomingCount = 0;

      GIGS.forEach(function(gig) {
        var gigDate = new Date(gig.date);
        gigDate.setHours(0, 0, 0, 0);

        // details ボタンとアコーディオンの有無
        var hasDetails = gig.time || (gig.artists && gig.artists.length > 0);
        var detailsHtml = '';
        if (hasDetails) {
          var innerHtml = '';
          if (gig.time) {
            innerHtml += '<div class="gig-time">' + gig.time + '</div>';
          }
          if (gig.artists) {
            gig.artists.forEach(function(a) {
              innerHtml += '<div class="gig-co-artists"><span class="gig-co-label">' + a.role + '</span>' + a.names + '</div>';
            });
          }
          detailsHtml =
            '<button class="gig-toggle" aria-expanded="false">details <span class="gig-toggle-icon">▾</span></button>' +
            '<div class="gig-details"><div class="gig-details-inner">' + innerHtml + '</div></div>';
        }

        var li = document.createElement('li');
        li.className = 'gig-item no-flyer anim-slide';
        li.innerHTML =
          '<div class="gig-body">' +
            '<div class="gig-info">' +
              '<span class="gig-event">' + gig.event + '</span>' +
              '<span class="gig-venue">' + gig.venue + '</span>' +
            '</div>' +
            '<span class="gig-date">' + gig.date.replace(/-/g, '.') + '</span>' +
          '</div>' +
          detailsHtml;

        if (gigDate >= today) {
          upcomingList.appendChild(li);
          upcomingCount++;
        } else {
          pastList.appendChild(li);
        }
      });

      if (upcomingCount === 0) {
        var empty = document.createElement('li');
        empty.className = 'gig-item no-flyer anim-slide';
        empty.innerHTML = '<div class="gig-body"><div class="gig-info"><span class="gig-event no-events">— no upcoming events</span></div></div>';
        upcomingList.appendChild(empty);
      }

      // アコーディオン
      document.querySelectorAll('.gig-toggle').forEach(function(btn) {
        btn.addEventListener('click', function() {
          var details = this.nextElementSibling;
          var isOpen = details.classList.contains('is-open');
          details.classList.toggle('is-open', !isOpen);
          this.classList.toggle('is-open', !isOpen);
          this.setAttribute('aria-expanded', String(!isOpen));
          this.querySelector('.gig-toggle-icon').textContent = isOpen ? '▾' : '▴';
        });
      });
    })();
  </script>
</body>
</html>
